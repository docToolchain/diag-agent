:jbake-title: Quality Requirements
:jbake-type: page_toc
:jbake-status: published
:jbake-menu: arc42
:jbake-order: 10
:filename: /chapters/10_quality_requirements.adoc
ifndef::imagesdir[:imagesdir: ../../images]

:toc:



[[section-quality-scenarios]]
== Quality Requirements

[[quality-goals]]
=== Quality Goals

[cols="1,2,1,1,2",options="header"]
|===
|Priority |Quality Goal |Motivation |Relevante Szenarien |Unterst√ºtzende ADRs

|1
|**Context Efficiency**
|Minimize token consumption in parent LLM conversations through help system, URL references, and self-contained agent logic
|xref:#scenario-context-efficiency[S1]
|xref:../adr/ADR-001-bash-tool-vs-mcp.adoc[ADR-001], xref:../adr/ADR-002-agent-self-iteration.adoc[ADR-002], xref:../adr/ADR-004-url-references.adoc[ADR-004], xref:../adr/ADR-008-click-cli.adoc[ADR-008]

|2
|**Ease of Installation**
|Developers should install via pip or docker run without complex setup
|xref:#scenario-installation[S2]
|xref:../adr/ADR-006-docker-bundled-kroki.adoc[ADR-006]

|3
|**Privacy & Security**
|No diagram data sent to remote servers without explicit user consent
|xref:#scenario-privacy[S4]
|xref:../adr/ADR-003-local-first-remote.adoc[ADR-003], xref:../adr/ADR-006-docker-bundled-kroki.adoc[ADR-006]

|4
|**Autonomy**
|Agent iterates independently without requiring parent LLM intervention
|xref:#scenario-context-efficiency[S1]
|xref:../adr/ADR-002-agent-self-iteration.adoc[ADR-002], xref:../adr/ADR-007-source-file-write.adoc[ADR-007]

|5
|**Extensibility**
|Support for all Kroki diagram types and easy LLM provider switching
|Future scenario (TBD)
|xref:../adr/ADR-005-litetllm-abstraction.adoc[ADR-005]
|===

=== Quality Scenarios

[#scenario-context-efficiency]
==== Scenario 1: Context Efficiency

Related Quality Goals: xref:#quality-goals[1 (Context Efficiency), 4 (Autonomy)]

[cols="1,3",options="header"]
|===
|Aspect |Description

|**Scenario**
|Architect asks LLM to generate C4 diagram in claude.ai

|**Environment**
|Claude with computer use enabled, existing conversation with 50k tokens

|**Stimulus**
|User: "Create a C4 context diagram for our API gateway"

|**Response**
|Claude calls `diag-agent create --help`, then executes command

|**Measure**
|Total context consumed < 2k tokens (help text + command + file path response)

|**Target**
|95% of diagram requests use < 3k tokens in parent conversation
|===

[#scenario-installation]
==== Scenario 2: Installation Time

Related Quality Goals: xref:#quality-goals[2 (Ease of Installation)]

[cols="1,3",options="header"]
|===
|Aspect |Description

|**Scenario**
|Developer installs diag-agent for first time

|**Environment**
|Fresh Ubuntu system, Python 3.10 installed, internet available

|**Stimulus** (v0.1.0)
|Developer runs: `git clone && cd diag-agent && uv pip install . && diag-agent create "test"`

|**Stimulus** (future PyPI)
|Developer runs: `uvx diag-agent create "test"` (no installation needed)

|**Response**
|Interactive setup guides through configuration, downloads Kroki if needed

|**Measure**
|< 5 minutes from first command to generated diagram (current: git clone + install)
< 2 minutes with uvx (future: when published to PyPI)

|**Target**
|90% of users generate first diagram within 5 minutes
|===

[#scenario-syntax]
==== Scenario 3: Syntax Error Recovery

Related Quality Goals: xref:#quality-goals[1 (Context Efficiency)]

[cols="1,3",options="header"]
|===
|Aspect |Description

|**Scenario**
|LLM generates PlantUML with syntax error

|**Environment**
|Agent with Claude Sonnet 4, local Kroki available

|**Stimulus**
|Invalid PlantUML: `participent User` (typo)

|**Response**
|Agent detects error, feeds back to LLM, receives corrected version

|**Measure**
|95% of common syntax errors fixed within 2 iterations

|**Target**
|< 10 seconds per iteration
|===

[#scenario-privacy]
==== Scenario 4: Privacy Compliance

Related Quality Goals: xref:#quality-goals[3 (Privacy & Security)]

[cols="1,3",options="header"]
|===
|Aspect |Description

|**Scenario**
|User generates diagram containing internal API details

|**Environment**
|Default configuration, no remote services configured

|**Stimulus**
|`diag-agent create "Internal microservices architecture"`

|**Response**
|All processing happens locally (LLM API + local Kroki)

|**Measure**
|Zero diagram data sent to kroki.io without explicit consent

|**Target**
|100% compliance with default settings
|===

=== Quality Tree

[plantuml, quality-tree, svg]
----
@startmindmap
* diag-agent
** Context Efficiency (High)
*** Minimal token consumption
*** Help-on-demand system
*** URL references (V2)
** Usability (High)
*** < 5 min to first diagram
*** Interactive setup
*** Clear error messages
** Privacy (High)
*** Local-first default
*** Explicit remote consent
*** No telemetry
** Reliability (Medium)
*** Syntax validation
*** Design feedback
*** Graceful degradation
** Performance (Medium)
*** < 60s per diagram
*** Iteration limits
*** Caching
** Maintainability (Medium)
*** Clear component boundaries
*** LiteLLM abstraction
*** Comprehensive logging
@endmindmap
----
