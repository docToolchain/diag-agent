:jbake-title: Context and Scope
:jbake-type: page_toc
:jbake-status: published
:jbake-menu: arc42
:jbake-order: 3
:filename: /chapters/03_context_and_scope.adoc
ifndef::imagesdir[:imagesdir: ../../images]

:toc:



[[section-context-and-scope]]
== Context and Scope

=== Business Context

[plantuml, business-context, svg]
----
@startuml
!include <C4/C4_Context>

Person(architect, "Software Architect", "Creates architecture documentation")
Person(developer, "Developer", "Generates diagrams for docs")
System_Ext(llm, "LLM Application", "Claude, GPT, Ollama, etc.")

System_Boundary(diag_agent, "diag-agent") {
    System(agent, "Diagram Agent", "Autonomous diagram generation with feedback loop")
}

System_Ext(kroki_remote, "kroki.io", "Remote diagram rendering")
System_Ext(kroki_local, "Local Kroki", "Self-hosted rendering service")

Rel(architect, agent, "Uses CLI", "bash commands")
Rel(developer, agent, "Uses CLI", "bash commands")
Rel(llm, agent, "Calls via MCP", "Tool invocation")

Rel(agent, kroki_local, "Renders diagrams", "HTTP API")
Rel(agent, kroki_remote, "Renders diagrams", "HTTP API (opt-in)")
Rel(agent, llm, "Requests generation", "LLM API")

SHOW_LEGEND()
@enduml
----

==== External Interfaces

[cols="1,2,2",options="header"]
|===
|Interface |Description |Protocol

|CLI
|Command-line interface for direct user interaction
|Bash commands, stdin/stdout

|MCP Server
|Model Context Protocol server for LLM integration
|HTTP/SSE (streaming)

|Kroki API
|Diagram rendering service
|HTTP REST (POST /render)

|LLM API
|Generation and analysis requests
|Provider-specific (OpenAI, Anthropic, etc.)
|===

=== Technical Context

[plantuml, technical-context, svg]
----
@startuml
!include <C4/C4_Context>

Person(user, "User/LLM", "Requests diagrams")

System_Boundary(agent, "diag-agent") {
    System(core, "diag-agent", "Autonomous diagram generation system")
}

System_Ext(llm_api, "LLM API", "Language model service")
System_Ext(kroki, "Kroki Service", "Diagram renderer")
System_Ext(storage, "File System", "Diagram outputs")

Rel(user, core, "CLI commands / MCP calls", "bash / HTTP")
Rel(core, llm_api, "Generation requests", "HTTPS/API")
Rel(core, kroki, "Render requests", "HTTP POST")
Rel(core, storage, "Write diagrams", "file I/O")

SHOW_LEGEND()
@enduml
----

==== Technical Interfaces

**Incoming:**
* **CLI**: Command-line interface accepting bash commands and arguments
* **MCP Server**: HTTP/SSE endpoint for LLM tool integration

**Outgoing:**
* **LLM API**: HTTPS requests to various LLM providers (OpenAI, Anthropic, Ollama, etc.)
* **Kroki API**: HTTP POST to rendering service (local or remote)
* **File System**: Write diagram source files and rendered images
