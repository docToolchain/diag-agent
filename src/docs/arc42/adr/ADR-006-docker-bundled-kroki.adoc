=== ADR-006: Docker-Bundled Kroki vs. Separate Service

**Status**: Accepted

**Context**: Users want simple installation. Kroki Fat-JAR is ~80MB. Should it be included in Docker image?

**Decision**: Include Kroki Fat-JAR in Docker image by default. Provide slim variant without it.

**Consequences**:
* ✅ One-command deployment: `docker run diag-agent`
* ✅ Works offline immediately
* ⚠️ Larger image size (~300MB vs ~50MB slim)
* ⚠️ Longer build times

**Related Quality Goals**: xref:../chapters/10_quality_requirements.adoc#quality-goals[2 Ease of Installation], xref:../chapters/10_quality_requirements.adoc#quality-goals[3 Privacy & Security]

==== Pugh Matrix

[cols="1,3*^",options="header"]
|===
|Criterion |Hosted Kroki service (baseline) |Local Docker Kroki (chosen) |Local native Kroki install

|Portability
|0
|+  (works offline)
|+  (offline)

|Setup Complexity
|+  (no local setup)
|-  (need Docker + image pull)
|-  (package install/maintenance)

|Runtime Reliability
|+  (managed uptime)
|+  (self-controlled uptime)
|0  (depends on host services)

|Security Surface
|-  (network and external trust)
|0  (limited to image and Docker)
|-  (host-level dependencies)
|===

**Alternatives Considered**:
* Multi-stage build with optional Fat-JAR (chosen approach)
* Always download on first run (slower, requires internet)
* Separate kroki container via docker-compose (more complex)
